let minMaxMap={},numLinksDict={},links_not_filtered,nodes_not_filtered,nodes,node_ids,links,currentLabHighlightList,currentYear="All",maxStrength,labs,simulation,svg,link,node,defs,pieG,minNumConnections=20,g,gl,referenceCache,currentTopic="All",mapMin=1,mapMax=60,startDegree=-135,endDegree=135,startPos=-48,currentDialDeg=startPos,numText,dialGroup,mousePos,linearGradient,gl_,linearGradientDict={},Tooltip,transformation,svgPoint,boundingRect,mouseIsDragging=!1,body,tooltipFlippedX=!1,tooltipFlippedY=!1,mouseIsOver=!1,objectBeingDragged;LABS_CONTINENT={vigyanashram:"Asia",oulu:"Europe",kamplintfort:"Europe",charlotte:"North America",lccc:"North America",bahrain:"Asia",uae:"Asia",libya:"Africa",techworks:"North America",newcairo:"Africa",egypt:"Africa",lakazlab:"Africa",tecsup:"South America",wheaton:"North America",fablabuae:"Asia",qbic:"Asia",kochi:"Asia",ied:"Europe",fablabtrivandrum:"Asia",fablabakgec:"Asia",barcelona:"Europe",fablabsorbonne:"Europe",fablabcept:"Asia",rwanda:"Africa",leon:"Europe",lamachinerie:"Europe",fablabdigiscope:"Europe",energylab:"Europe",akgec:"Asia",irbid:"Asia",reykjavik:"Europe",sorbonne:"Europe",incitefocus:"North America",puebla:"North America",tecsupaqp:"South America",ucontinental:"South America",fablabopendot:"Europe",santachiara:"Europe",fablabechofab:"North America",zoi:"Asia",cidi:"North America",dassault:"Europe",stjude:"North America",aalto:"Europe",fablabzoi:"Asia",ecae:"Asia",fablabbahrain:"Asia",khairpur:"Asia",insper:"South America",trivandrum:"Asia",inphb:"Africa",digiscope:"Europe",ulb:"Europe",lima:"South America",fablabspinderihallerne:"Europe",fablabfct:"Europe",fct:"Africa",opendot:"Europe",fablabtecsup:"South America",vancouver:"North America",fablabbrighton:"Europe",akureyri:"Europe",yucatan:"North America",bhutan:"Asia",fablabaachen:"Europe",waag:"Europe",echofab:"North America",dilijan:"Asia",polytech:"Europe",agrilab:"Asia",fablabsiena:"Europe",winam:"Africa",fablaboulu:"Europe",fablabreykjavik:"Europe",kamakura:"Asia",falabvestmannaeyjar:"Europe",singapore:"Asia",oshanghai:"Asia",fablaboshanghai:"Asia",fablabutec:"South America",fablabodessa:"Europe",esan:"South America",fablabvigyanasharm:"Asia",hkispace:"Asia",taipei:"Asia",fablabmexico:"North America",ciudadmexico:"North America",aachen:"Europe",fablabbottrop:"Europe",fablabaalto:"Europe",keolab:"Asia",cpcc:"North America",fablabkamplintfort:"Europe",ingegno:"Europe",fablabkamakura:"Asia",tinkerers:"Asia",cit:"Europe",utec:"South America",fablabamsterdam:"Europe",tianhelab:"Asia",bhubaneswar:"Asia",cept:"Asia",fablabbeijing:"Asia",talents:"Europe",fablabyachay:"South America",fablabdassault:"Europe",ecostudio:"North America",fablabseoul:"Asia",kaust:"Asia",berytech:"Asia",fablabpuebla:"North America",fablabrwanda:"Africa",fablabesan:"South America",fablabberytech:"Asia",crunchlab:"Europe",ucal:"North America",vestmannaeyjar:"Europe",sedi:"Europe",isafjordur:"Europe",fablabegypt:"Africa",szoil:"Asia",formshop:"Asia",fablabkochi:"Asia",fablabincitefocus:"North America",kitakagaya:"Asia",kannai:"Asia",dhahran:"Asia",seoulinnovation:"Asia",ioannina:"Europe",fablabyucatan:"North America",fablabirbid:"Asia",deusto:"Europe",falabdeusto:"Europe",riidl:"Asia",bottrop:"Europe",fablabisafjorour:"Europe",plusx:"Asia",fablaberfindergarden:"Europe",uemadrid:"Europe",fablabtembisa:"Africa",brighton:"Europe",fablabfacens:"South America",fablableon:"Europe",fablabszoil:"Asia",fablabgearbox:"Africa",farmlabalgarve:"Europe",algarve:"Europe",twarda:"Europe",bangalore:"Asia",fablabsantiago:"South America",fablablccc:"North America",fablabcharlottelatin:"North America",fablabat3flo:"Europe",fablabecostudio:"North America",fablabsocom:"Asia",boldseoul:"Asia",napoli:"Europe",fablabkromlaboro:"Europe",seoul:"Asia",fablabtechworks:"North America",fablabkhairpur:"Asia",chaihuo:"Asia",fablabulb:"Europe",esne:"Europe",ulima:"South America",fablabseoulinnovation:"Asia",benfica:"Europe",fablabmadridceu:"Europe",chandigarh:"Asia",jubail:"Asia",ningbo:"Asia",fablabwgtn:"Oceania"};const updateCallbacks=[(t,e)=>{let a=(t,a,n)=>{let l=t.filter(t=>n(t)),o=l.map(t=>t.id);return[l,JSON.parse(JSON.stringify(a)).filter(t=>(t.topic==e.topic||"All"==e.topic)&&o.includes(t.target)&&o.includes(t.source))]},[n,l]=a(t.nodes,t.links,t=>"All"==e.topic?sumObj(numLinksDict[t.id].target)>=e.minNumConnections:numLinksDict[t.id].target[e.topic]>=e.minNumConnections);return{nodes:n,links:l}}],calculationCallbacks=[(t,e)=>{let a=0;return t.links.forEach(t=>{t.value>a&&(a=t.value)}),{maxStrength:a}},(t,e)=>({condensedLinks:condenseLinksforSimulation(t.links)}),(t,e,a)=>{let n=e.gl.selectAll("path").data(a.condensedLinks,t=>uniqueId(t));n.exit().remove();let l=n.enter().append("path").merge(n);return{link:l}},(t,e)=>{let a=e.g.selectAll("circle").data(t.nodes,t=>t.id);a.exit().remove();let n=a.enter().append("circle").merge(a);return{node:n}}],attributeCallbacks=[(t,e,a)=>{e.node.attr("r",t=>referenceCache[t.id][a.topic]),a.simulation.nodes(t.nodes),forceCollide.initialize(t.nodes)},(t,e,a)=>{a.simulation.force("link",d3.forceLink(e.condensedLinks).id(t=>t.id).distance(t=>getSimulationForceLinkDistance(t))),a.simulation.force("collision",forceCollide.radius(t=>t.r))},(t,e,a)=>{e.node.attr("fill",t=>{let e=t.id.split(";")[1].split("/")[5];return colorRegion(LABS_CONTINENT[e])}).attr("opacity",NODE_HIGHLIGHTED_OPACITY).call(d3.drag().on("start",dragstarted).on("drag",dragged).on("end",dragended))},(t,e,a)=>{e.link.attr("fill","none").attr("stroke-width",LINE_WIDTH).style("stroke-linecap","round")},(t,e,a)=>{let n=()=>{e.link.attr("d",t=>{let e=getGradientID(t),n=document.getElementById(e),{source:l,sourceYear:o,sourceLab:s,target:c,targetYear:u,targetLab:d}=getLinkSummary(t),p=activationCheck(a.year,a.currentLabHighlightList,o,s),f=activationCheck(a.year,a.currentLabHighlightList,u,d);p&&f||!(p||f)||(p?(n.setAttribute("x1",t.source.x),n.setAttribute("y1",t.source.y),n.setAttribute("x2",t.target.x),n.setAttribute("y2",t.target.y)):(n.setAttribute("x2",t.source.x),n.setAttribute("y2",t.source.y),n.setAttribute("x1",t.target.x),n.setAttribute("y1",t.target.y)));let h=d3.path();return h.moveTo(t.source.x,t.source.y),h.lineTo(t.target.x,t.target.y),h.toString()})};n(),a.simulation.on("tick",()=>{n(),e.node.attr("cx",t=>t.x).attr("cy",t=>t.y)})},(t,e,a)=>{e.node.attr("opacity",t=>{let e=t.id.split(";")[1].split("/")[3],n=t.id.split(";")[1].split("/")[5];return(e==a.year||"All"==a.year)&&a.currentLabHighlightList.includes(n)?NODE_HIGHLIGHTED_OPACITY:minOpacity})},(t,e,a)=>{e.link.attr("opacity",t=>{let{source:e,sourceYear:n,sourceLab:l,target:o,targetYear:s,targetLab:c}=getLinkSummary(t),u=!1,d=!1;return(activationCheck(a.year,a.currentLabHighlightList,n,l)&&(u=!0),activationCheck(s,c)&&(d=!0),(u||d)&&!(u&&d))?null:1}),e.link.attr("stroke",t=>{let e=t.source.id,n=e.split(";")[1].split("/")[3],l=e.split(";")[1].split("/")[5],o=t.target.id,s=o.split(";")[1].split("/")[3],c=o.split(";")[1].split("/")[5],u=!1,d=!1;return(activationCheck(a.year,a.currentLabHighlightList,n,l)&&(u=!0),activationCheck(a.year,a.currentLabHighlightList,s,c)&&(d=!0),u&&d)?"rgba("+RGB_LINE_COLOR+",1)":u||d?`url(#${getGradientID(t)})`:"rgba("+RGB_LINE_COLOR+",0.05)"})},(t,e,a)=>{e.node.each(function(t,e){let a=d3.select(this);a.on("mouseover")||(a.on("mouseover",tooltipMouseover).on("mousemove",tooltipMousemove).on("mouseleave",tooltipMouseleave),a.on("click",(t,e)=>{window.open(e.id.split(";")[1],"_blank")}))})},(t,e,a)=>a.simulation.alpha(1).restart()],filterData=(t,e)=>{let a={nodes:nodes_not_filtered,links:links_not_filtered};for(let n of t)a=n(a,e);return a},runCalculations=(t,e,a)=>{let n={};for(let l of t)n={...n,...l(e,a,n)};return n},setDataAttributes=(t,e,a,n)=>{for(let l of t)l(e,a,n)},updateData=t=>{t={...t,topic:"topic"in t?t.topic:currentTopic,year:currentYear,currentLabHighlightList};let e=filterData(updateCallbacks,t),a=runCalculations(calculationCallbacks,e,t);setDataAttributes(attributeCallbacks,e,a,t)},clamp=(t,e,a)=>Math.min(Math.max(t,e),a),toTitleCase=t=>t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()});function normalize(t,e,a){return(t-e)/(a-e)}const calculateMinMax=(t,e,a)=>{let n=1/0,l=-1/0;return t.forEach(t=>{let o=0;e.forEach(e=>{e.target==t.id&&(a==e.topic||"All"==a)&&(o+=e.value)}),o<n&&(n=o),o>l&&(l=o)}),{min:n,max:l}},sumObj=t=>Object.values(t).reduce((t,e)=>t+e,0),getAllLabs=t=>{let e=[];for(let a=0;a<t.length;a++){let n=t[a],l=n.split(";")[1].split("/")[5];e.includes(l)||e.push(l)}return e},filterStudents=(t,e,a)=>{let n=t.filter(t=>a(t)),l=n.map(t=>t.id),o=JSON.parse(JSON.stringify(e)).filter(t=>(l.includes(t.target.id)||l.includes(t.target))&&l.includes(t.source.id)|l.includes(t.source));return[n,l,o]},uniqueId=t=>{let e,a;return"string"==typeof t.source?(e=t.source,a=t.target):(e=t.source.id,a=t.target.id),`${e}${a}${t.topic}${t.value}`},createNumLinksDictFrom_not_filtered=()=>{for(let t=0;t<nodes_not_filtered.length;t++){let e={source:{},target:{}};for(let a=0;a<TOPICS.length;a++)e.source[TOPICS[a]]=0,e.target[TOPICS[a]]=0;numLinksDict[nodes_not_filtered[t].id]=e}for(let n=0;n<links_not_filtered.length;n++){let l=links_not_filtered[n];numLinksDict[l.target].target[l.topic]+=l.value,numLinksDict[l.source].source[l.topic]+=l.value}},create_not_filteredFromJSON=async()=>d3.json("final_data.json").then(t=>{links_not_filtered=t.links.map(t=>Object.assign({},t)).filter(t=>t.target!=t.source),nodes_not_filtered=t.nodes.map(t=>Object.assign({},t))}),assignFilter=t=>([nodes,node_ids,links]=t),transferNot_filteredToArrays=()=>{assignFilter(filterStudents(nodes_not_filtered,links_not_filtered,t=>"All"==currentTopic?sumObj(numLinksDict[t.id].target)>=minNumConnections:numLinksDict[t.id].target[currentTopic]>=minNumConnections))},initializeDefs=()=>{linearGradient=d3.select("defs").selectAll("linearGradient")},getGradientID=t=>{let e,a;try{e=t.source.id.replace(/\W/g,"_")}catch{e=t.source.replace(/\W/g,"_")}try{a=t.target.id.replace(/\W/g,"_")}catch{a=t.target.replace(/\W/g,"_")}return`gradient_${e}|${a}`},registerLinearGradients=t=>{let e=linearGradient.data(t,t=>getGradientID(t));e.exit().each(function(t,e){let a=d3.select(this);document.remove(linearGradient[getGradientID(a)]),delete linearGradient[getGradientID(a)]}).remove();let a=e.enter().append("linearGradient").attr("gradientUnits","userSpaceOnUse").attr("id",t=>getGradientID(t)).attr("x1",0).attr("x2",1).attr("y1",0).attr("y2",0);a.append("stop").attr("offset","0%").attr("stop-color","rgba("+RGB_LINE_COLOR+",1)"),a.append("stop").attr("offset","100%").attr("stop-color","rgba("+RGB_LINE_COLOR+",0)"),d3.select("defs").selectAll("linearGradient").each(function(t,e){let a=d3.select(this);linearGradientDict[getGradientID(t)]=a})},condenseLinksforSimulation=t=>{let e=[];for(let a of t){condensed=!1;for(let n=0;n<e.length;n++){r=e[n];let l,o,s,c;if(l="string"==typeof a.target?a.target:a.target.id,o="string"==typeof r.target?r.target:r.target.id,s="string"==typeof a.source?a.source:a.source.id,c="string"==typeof r.source?r.source:r.source.id,l==o&&s==c||l==c&&s==o){e[n].value+=a.value,condensed=!0;break}}condensed||(delete a.topic,e.push(a))}return e},calculateMaxStrength=()=>{maxStrength=0,links.forEach(t=>{t.value>maxStrength&&(maxStrength=t.value)})},setLabs=t=>labs=getAllLabs(t).sort(),setCurrentLabHighlightList=()=>currentLabHighlightList=labs,calculateSimulationStrength=(t,e)=>t=>MINIMUM_STRENGTH_CONSTANT+Math.sqrt((10*normalize(t.value,0,maxStrength)+1)/SCALE_FACTOR),createSimulation=()=>{simulation=d3.forceSimulation(nodes).force("boundary",forceBoundary(forceBoundaryMargin,forceBoundaryMargin,width-forceBoundaryMargin,height-forceBoundaryMargin)).force("link",d3.forceLink(links).id(t=>t.id).strength(t=>calculateSimulationStrength(t,maxStrength))).force("charge",d3.forceManyBody().strength(-60)).force("center",d3.forceCenter(width/2,height/2))},createAndFormatSVG=()=>{transformation=(svg=d3.select("svg").attr("width",width).attr("height",height).attr("viewBox",[0,0,width,height]).style("max-width","100%").style("height","auto").style("background-color","white")).node().getCTM(),svgPoint=svg.node().createSVGPoint(),boundingRect=svg.node().getBoundingClientRect()},linksToLink=t=>{t&&(gl=svg.append("g").attr("transform","translate(150, -10)"));let e=gl.selectAll("path").data(condenseLinksforSimulation(links),t=>uniqueId(t));return e.exit().remove(),e.enter().append("path").merge(e).attr("fill","none").attr("stroke-width",LINE_WIDTH).style("stroke-linecap","round").attr("opacity",t=>(normalize(t.value,0,maxStrength)/2+.5)/SCALE_FACTOR),e},calculateMinMaxMapFromFiltered=()=>{[...TOPICS,"All"].forEach(t=>{minMaxMap[t]=calculateMinMax(nodes_not_filtered,links_not_filtered,t)})},nodesToNodeAndFormat=()=>{g=node=svg.append("g").attr("transform","translate(150, -10)")},configureNode=(t,e)=>{let a=g.selectAll("circle").data(e,t=>t.id);a.exit().remove();let n=a.enter().append("circle").merge(a);return n.attr("r",t=>referenceCache[t.id].All),n.attr("fill",t=>{let e=t.id.split(";")[1].split("/")[5];return colorRegion(LABS_CONTINENT[e])}).attr("opacity",NODE_HIGHLIGHTED_OPACITY).call(d3.drag().on("start",dragstarted).on("drag",dragged).on("end",dragended)),g.selectAll("circle")};function dragstarted(t,e){objectBeingDragged=d3.select(this),t.active||simulation.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y,mouseIsDragging=!0}function dragged(t,e){e.fx=t.x,e.fy=t.y}function dragended(t,e){t.active||simulation.alphaTarget(0),e.fx=null,e.fy=null,mouseIsDragging=!1;let a=pointerOutOfSVG();a&&tooltipMouseleave(null,null,objectBeingDragged),objectBeingDragged=null}const getSimulationForceLinkDistance=t=>referenceCache[t.target.id][currentTopic]+referenceCache[t.source.id][currentTopic],calibrateSimulation=()=>{simulation.force("collision",forceCollide.radius(t=>t.r/1.2)),simulation.force("link",d3.forceLink(links).id(t=>t.id).distance(t=>getSimulationForceLinkDistance(t)))},activationCheck=(t,e,a,n)=>(a==t||"All"==t)&&e.includes(n),linkTick=()=>{link.attr("d",t=>{let e=getGradientID(t),a=document.getElementById(e),{source:n,sourceYear:l,sourceLab:o,target:s,targetYear:c,targetLab:u}=getLinkSummary(t),d=activationCheck(l,o),p=activationCheck(c,u);d&&p||!(d||p)||(d?(a.setAttribute("x1",t.source.x),a.setAttribute("y1",t.source.y),a.setAttribute("x2",t.target.x),a.setAttribute("y2",t.target.y)):(a.setAttribute("x2",t.source.x),a.setAttribute("y2",t.source.y),a.setAttribute("x1",t.target.x),a.setAttribute("y1",t.target.y)));let f=d3.path();return f.moveTo(t.source.x,t.source.y),f.lineTo(t.target.x,t.target.y),f.toString()})},setSimulationTick=(t,e)=>{linkTick(),simulation.on("tick",()=>{linkTick(),t.attr("cx",t=>t.x).attr("cy",t=>t.y)})},selectByTopic=t=>{currentTopic=t;let e=0;links.forEach(a=>{a.value>e&&(a.topic==t||"All"==t)&&(e=a.value)}),link.attr("opacity",a=>a.topic==t||"All"==t?(normalize(a.value,0,e)/2+.5)/SCALE_FACTOR:0),simulation.force("link",d3.forceLink(links).id(t=>t.id).strength(t=>calculateSimulationStrength(t,e)).distance(t=>getSimulationForceLinkDistance(t)));let a=[];links.forEach(e=>{(e.topic==t||"All"==t)&&a.push(e)}),node.attr("r",e=>referenceCache[e.id][t]),simulation.force("link",d3.forceLink(a).id(t=>t.id).distance(t=>getSimulationForceLinkDistance(t))),forceCollide.initialize(nodes),simulation.alpha(1).restart()},configureGlowDefinitions=()=>{(defs=svg.append("defs")).append("filter").attr("id","sofGlow").attr("width","300%").attr("height","300%").attr("x","-100%").attr("y","-100%").attr("stdDeviation","1").attr("result","coloredBlur").append("feGaussianBlur").attr("in","thicken").attr("stdDeviation","1").attr("result","blurred")},getLinkSummary=t=>{let e=t.source.id,a=e.split(";")[1].split("/")[3],n=e.split(";")[1].split("/")[5],l=t.target.id,o=l.split(";")[1].split("/")[3],s=l.split(";")[1].split("/")[5];return{source:e,sourceYear:a,sourceLab:n,target:l,targetYear:o,targetLab:s}},setLinkOpacity=()=>{link.attr("opacity",t=>{let{source:e,sourceYear:a,sourceLab:n,target:l,targetYear:o,targetLab:s}=getLinkSummary(t),c=!1,u=!1;return(activationCheck(a,n)&&(c=!0),activationCheck(o,s)&&(u=!0),(c||u)&&!(c&&u))?null:1}),link.attr("stroke",t=>{let e=t.source.id,a=e.split(";")[1].split("/")[3],n=e.split(";")[1].split("/")[5],l=t.target.id,o=l.split(";")[1].split("/")[3],s=l.split(";")[1].split("/")[5],c=!1,u=!1;return((a==currentYear||"All"==currentYear)&&currentLabHighlightList.includes(n)&&(c=!0),(o==currentYear||"All"==currentYear)&&currentLabHighlightList.includes(s)&&(u=!0),c&&u)?"rgba(255,255,255"+((normalize(t.value,0,maxStrength)/2+.5)/SCALE_FACTOR).toString()+")":c||u?`url(#${getGradientID(t)})`:"rgba(255,255,255,0.05)"})},setYear=t=>{currentYear=t,updateData({minNumConnections,simulation,svg,g,gl:gl_})},createPie=()=>{let t=svg.append("g").attr("transform","translate("+pieX+","+pieY+") rotate("+360/14+")");var e={All:1};for(let a=2018;a<=2023;a++)e[a]=1;var n,l=d3.pie().value(function(t){return t.value})(Object.entries(e).map(([t,e])=>({key:t,value:e}))),o=d3.arc().innerRadius(50).outerRadius(pieRadius);let s=e=>{var a=-((e.startAngle+e.endAngle)/2);t.transition().duration(1e3).attr("transform","translate("+pieX+","+pieY+") rotate("+a/Math.PI*180+")")};t.selectAll("mySlices").data(l).enter().append("path").attr("d",o).attr("fill",PIE_SLICE_COLOR).attr("stroke","white").style("stroke-width","2px").style("opacity",1).on("click",function(t,e){setYear(e.data.key),s(e)}),t.selectAll("mySlices").data(l).enter().append("text").text(function(t){return t.data.key}).attr("dy","0.3em").attr("transform",function(t){return"translate("+o.centroid(t)+") rotate("+(t.startAngle+t.endAngle)/2*(180/Math.PI)+")"}).style("text-anchor","middle").style("fill",PIE_TEXT_COLOR).attr("font-weight",700).attr("font-family","Saira").style("font-size",18).on("click",function(t,e){setYear(e.data.key),s(e)})},createReferenceCache=()=>{referenceCache={},["All",...TOPICS.slice(1,-1)].forEach(t=>{nodes_not_filtered.forEach(e=>{let a=0;links_not_filtered.forEach(n=>{n.target==e.id&&("All"==t||n.topic==t)&&(a+=n.value)}),a=normalize(a,minMaxMap[t].min,minMaxMap[t].max)*NODE_SIZE_MULTIPLIER*((1-1/minMaxMap[t].max)/2)+NODE_SIZE_MINIMUM,a/=SCALE_FACTOR,e.r=a,e.id in referenceCache||(referenceCache[e.id]={}),referenceCache[e.id][t]=a})})},centerText=(t,e)=>{let a=t.node().getBBox().width;t.attr("x",e-a/2)};window.addEventListener("pointermove",t=>{mousePos={x:t.clientX,y:t.clientY};let e=Tooltip.node().offsetWidth,a=Tooltip.node().offsetHeight,n=document.documentElement.clientWidth,l=document.documentElement.clientHeight,o=t.clientX+body.scrollLeft+50,s=t.clientY+body.scrollTop-10,c={x:50,y:10};o+e+c.x-body.scrollLeft>n&&(o=o-e-100),s+a+c.y-body.scrollTop>l&&(s=s-a+20),Tooltip.style("left",o+"px"),Tooltip.style("top",s+"px")});const pointerOutOfSVG=()=>{let t=document.elementFromPoint(mousePos.x,mousePos.y);return!(svg.node()===t||svg.node().contains(t))},tooltipMouseover=function(t,e){mouseIsOver||(mouseIsOver=!0,Tooltip.style("display","initial").style("visibility","visible"),d3.select(this).style("stroke",HOVER_NODE_STROKE_COLOR).style("stroke-width",NODE_STROKE_WIDTH_HIGHLIGHTED))};var tooltipMousemove=function(t,e){Tooltip.html("<span>Student: "+e.id.split(";")[0]+"<br>Year: "+e.id.split(";")[1].split("/")[3]+"<br>Lab: "+e.id.split(";")[1].split("/")[5]+'<br>Region: <span style="color:'+colorRegion(LABS_CONTINENT[e.id.split(";")[1].split("/")[5]])+';">'+LABS_CONTINENT[e.id.split(";")[1].split("/")[5]]+"</span></span>")},tooltipMouseleave=function(t,e,a=null){mouseIsDragging||(mouseIsOver=!1,Tooltip.style("display","none").style("visbility","hidden"),(null==a?d3.select(this):a).style("stroke",NOT_HOVERING_NODE_STROKE_COLOR).style("stroke-width",NOT_HOVERING_NODE_STROKE_WIDTH))};const NODE_STROKE_WIDTH_HIGHLIGHTED="1.5px",HOVER_NODE_STROKE_COLOR="black",NOT_HOVERING_NODE_STROKE_WIDTH="0px",NOT_HOVERING_NODE_STROKE_COLOR="",RGB_LINE_COLOR="0,0,0",LINE_WIDTH="0.3px",CAROUSEL_RECT_STROKE_COLOR="",CAROUSEL_RECT_STROKE_WIDTH="0px",CAROUSEL_SELECTOR_COLOR="black",DIAL_OUTLINE_COLOR="grey",DIAL_TEXT_COLOR="black",OVERLAY_TEXT_LINK_COLOR="#7e7eed",SCALE_FACTOR=1,forceBoundaryMargin=30,minOpacity=.15,NODE_HIGHLIGHTED_OPACITY=1,MINIMUM_STRENGTH_CONSTANT=100,PIE_SLICE_COLOR="grey",PIE_TEXT_COLOR="white",DIAL_STICK_COLOR="grey",CAROUSEL_OPTION_COLOR="grey",CAROUSEL_TEXT_COLOR="white",FAB_PALETTE=["#f1f2f2","#f1d2f2","#f1b2f2","#f04260","#4abfbd","#284fb5","#f05c71"],NODE_REGION_PALETTE=["#1da619","#f04260","#4abfbd","#284fb5","#f05be1"],continent=["Africa","Asia","Europe","North America","South America"],continentColor={};for(let i=0;i<NODE_REGION_PALETTE.length;i++)continentColor[continent[i]]=NODE_REGION_PALETTE[i];const NODE_SIZE_MULTIPLIER=50,NODE_SIZE_MINIMUM=5,TOPICS=["Prefab","Computer-Aided Design","Computer-Controlled Cutting","Embedded Programing","3D Scanning and Printing","Electronics Design","Computer-Controlled Machining","Electronics Production","Mechanical Design, Machine Design","Input Devices","Moulding and Casting","Output Devices","Embedded Networking and Communications","Interface and Application Programming","Wildcard Week","Applications and Implications","Invention, Intellectual Property and Business Models","Final Project","Other"],nonDiacriticLetters="abcdefghijklmnopqrstuvwxyz",width=1856,height=900,colorRegion=t=>continentColor[t],colorFab=d3.scaleOrdinal().range(FAB_PALETTE),shape=d3.scaleOrdinal().range(d3.symbols),radius_dict={},forceCollide=d3.forceCollide(),pieX=210,pieY=720,pieRadius=100,topicCarouselList=["All",...TOPICS.slice(1,-1)],initializeCarousel=(t,e,a,n,l,o,s,c)=>{let u=s.append("g"),d=d3.scaleBand().range([0,n]).domain(e).padding(.2);d3.scaleOrdinal().range(c),u.selectAll("rect").data(e).enter().append("rect").attr("x",10+l).attr("y",t=>d(t)+o).attr("width",a).attr("height",d.bandwidth()).attr("stroke","").attr("stroke-width","0px").attr("fill","grey").on("click",(t,e)=>{v(e)});var p,f=n/e.length-d.bandwidth()+a,h=n/e.length,m=a,b=d.bandwidth(),A={top:d(e[0])+(d.bandwidth()-n/e.length)/2,left:10-(n/e.length-d.bandwidth())/2,width:f,height:h},y={top:A.top+(h-b)/2,left:A.left+(f-m)/2,width:m,height:b},E=["M",A.left,A.top,"h",f,"v",h,"h",-f,"v",-h,"M",y.left,y.top,"h",m,"v",b,"h",-m,"v",-b,"Z"].join(" "),k=u.append("defs").append("mask").attr("id","myMask");k.append("rect").attr("x",l).attr("y",o).attr("width","100%").attr("height","100%").attr("fill","white"),k.append("rect").attr("x",y.left+l).attr("y",y.top+o).attr("width",y.width).attr("height",y.height).attr("fill","black");let x=u.append("rect").attr("x",A.left+l).attr("y",A.top+o).attr("width",A.width).attr("height",A.height).attr("fill","black").attr("mask","url(#myMask)"),v=a=>{x.transition().duration(1e3).attr("transform","translate(0, "+(d(a)-d(e[0]))+")"),t(a)},L=u.selectAll("text").data(e).enter().append("text").attr("x",10+a/2+l).attr("y",t=>d(t)+d.bandwidth()/2+o).attr("dy","0.3em").text(t=>t).on("click",(t,e)=>{v(e)});L.style("text-anchor","middle").style("fill","white").attr("font-weight",700).attr("font-family","Saira").attr("font-size",13)};let prevSentToCallback;const strokeWidth=12,dialY=pieY,dialX=width-pieX,generateDialMapScale=()=>d3.scaleLinear().domain([startDegree,endDegree]).range([clamp(mapMin,1,1/0),mapMax]),updateDialText=(t,e)=>{if(!dialGroup)return;dialGroup.attr("transform",`translate(${dialX}, ${dialY}) rotate(${t})`);var a,n=generateDialMapScale()(t);let l=Math.round(n);numText.text(l),numTextWidth=numText.node().getBBox().width,numText.attr("x",dialX-numTextWidth/2),e(l)};function convertSVGtoScreenCoordinates(t,e,a){var n=t.createSVGPoint();n.x=e,n.y=a;var l=n.matrixTransform(t.getScreenCTM());return{x:l.x,y:l.y}}function calculateAngle(t,e){let a=e.y-t.y,n;return Math.atan2(a,e.x-t.x)}const initializeDial=(t,e)=>{var a=+t.attr("width"),n=+t.attr("height"),l=pieRadius-6,o=document.getElementById("value-input");let s=(t,e,a)=>Math.min(Math.max(t,e),a),c=t.append("text");c.attr("x",dialX).attr("y",dialY+(l+24)).text("Minimum Times Referenced").attr("font-family","sans-serif").attr("font-size","13px").attr("fill",DIAL_TEXT_COLOR),centerText(c,dialX),(numText=t.append("text")).attr("x",dialX).attr("y",dialY+(l/2+12)).text("20").attr("font-family","sans-serif").attr("font-size","40px").attr("fill",DIAL_TEXT_COLOR);let u=numText.node().getBBox().width;numText.attr("x",dialX-u/2),window.addEventListener("mousemove",t=>{mousePos={x:t.clientX,y:t.clientY}});var d,p=d3.drag().on("start",(t,e)=>{e.x=t.sourceEvent.clientX,e.y=t.sourceEvent.clientY,e.currentDeg||(e.currentDeg=startPos)}).on("drag",(t,a)=>{let n=convertSVGtoScreenCoordinates(document.getElementsByTagName("svg")[0],dialX,dialY),l={x:t.sourceEvent.clientX,y:t.sourceEvent.clientY},o=calculateAngle(n,l)*(180/Math.PI),c=calculateAngle(n,{x:a.x,y:a.y})*(180/Math.PI),u=(o-c+180+360)%360-180;a.x=l.x,a.y=l.y,a.degNew=u+a.currentDeg,a.currentDeg=a.degNew,currentDialDeg=s(u+currentDialDeg,startDegree,endDegree),updateDialText(currentDialDeg,e)}).on("end",(t,e)=>{e.currentDeg=e.degNew});(dialGroup=t.append("g").data([{x:0,scale:d3.scaleLinear().domain([0,a]).range([startDegree,endDegree])}]).attr("transform",`translate(${dialX}, ${dialY}) rotate(${startPos})`).call(p)).append("circle").attr("r",l).style("fill","transparent"),dialGroup.append("circle").attr("r",l).style("fill","none").style("stroke","grey").style("stroke-width","12px"),dialGroup.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",-(l-12)).style("stroke","grey").style("stroke-width","12px").style("stroke-linecap","round");var f=d3.scaleLinear().domain([startDegree,endDegree]).range([mapMin,mapMax])(startPos)};Array.prototype.search=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return -1};var Multiselect=function(t,e){if(!$(t)){console.error("ERROR: Element %s does not exist.",t);return}this.selector=t,this.selections=[],this.callback=e,function(t){t.events(e)}(this)};Multiselect.prototype={open:function(t){$(t).parent().attr("data-target"),this.selections||(this.selections=[]),$(this.selector+".multiselect").toggleClass("active")},close:function(){$(this.selector+".multiselect").removeClass("active")},events:function(t){var e=this;$(document).on("click",e.selector+".multiselect > .title",function(t){0>t.target.className.indexOf("close-icon")&&e.open()}),$(document).on("click",e.selector+".multiselect > .title > .close-icon",function(t){e.clearSelections()}),$(document).on("click",e.selector+".multiselect option",function(a){var n=$(this).attr("value"),l=$(e.selector+".multiselect option").length;if("All"==n)0>e.selections.search("All")?e.selections=$(e.selector+".multiselect option").map(function(){return $(this).val()}).get():e.selections=[];else{var o=e.selections.search(n);if(o<0?e.selections.push(n):e.selections.splice(o,1),e.selections.length!==l&&e.selections.search("All")>=0){let s=e.selections.search("All");-1!=s&&e.selections.splice(s,1)}else e.selections.length===l-1&&0>e.selections.search("All")&&e.selections.push("All")}e.selectionStatus(),e.setSelectionsString(),"function"==typeof t&&t(e.selections)})},selectionStatus:function(){var t=$(this.selector+".multiselect");this.selections.length?t.addClass("selection"):t.removeClass("selection")},clearSelections:function(){this.selections=[],this.selectionStatus(),this.setSelectionsString(),this.callback([])},getSelections:function(){return this.selections},setSelectionsString:function(){var t=this.getSelectionsString().split(", ");$(this.selector+".multiselect > .title").attr("title",t);var e=$(this.selector+".multiselect option");t.toString().length>16?$(this.selector+".multiselect > .title > .text").text(t.toString().slice(0,16)+"..."):$(this.selector+".multiselect > .title > .text").text(t);for(var a=0;a<e.length;a++)$(e[a]).removeClass("selected");for(var n=0;n<t.length;n++)for(var l=t[n],a=0;a<e.length&&($(e[a]).attr("value")!=l&&"All"!=l||($(e[a]).addClass("selected"),"All"==l));a++);},getSelectionsString:function(){return this.selections.search("All")>=0?"All":this.selections.length>0?this.selections.join(", "):"Filter Labs"},setSelections:function(t){if(!t[0]){error("ERROR: This does not look like an array.");return}this.selections=t,this.selectionStatus(),this.setSelectionsString()}};const initializeLabMultiselect=(t,e)=>{$(document).ready(function(){new Multiselect("#countries",e)});let a=d3.select("#my_dataviz").select("div div.container");a.selectAll("option").data(["All"].concat(t)).join("option").attr("value",t=>t).html(t=>t)},createOverlayText=()=>{createdBy()},createdBy=()=>{let t=(t,e,a,n)=>{let l=height-t;svg.append("text").attr("font-size","14px").attr("x",10).attr("y",l).attr("class","overlay-text").text(e+" ").append("a").attr("xlink:href",n).attr("target","_blank").style("fill","#7e7eed").attr("font-size","14px").text(a)};t(50,"Created by","Adam Stone","https://fabacademy.org/2023/labs/charlotte/students/adam-stone/"),t(35,"For documentation","click here","https://gitlab.fabcloud.org/pub/project/expert-network-map/-/blob/b15d89d91454904d523efbfc174db7638cc8f462/documentation.md"),t(20,"Took inspiration from","Nadieh Bremer","https://royalconstellations.visualcinnamon.com/"),t(5,"Recieved guidance and support from","Francisco Sanchez","https://www.fablabs.io/users/francisco")};window.onload=()=>{Tooltip=d3.select("#tooltip"),body=document.getElementsByTagName("body")[0],create_not_filteredFromJSON().then(()=>{calculateMinMaxMapFromFiltered(),createReferenceCache(),createNumLinksDictFrom_not_filtered(nodes_not_filtered,links_not_filtered),setLabs(nodes_not_filtered.map(t=>t.id)),transferNot_filteredToArrays(),calculateMaxStrength(),setCurrentLabHighlightList(),createSimulation(),createAndFormatSVG(),initializeDefs(),gl_=svg.append("g").attr("transform","translate(150, -10)"),registerLinearGradients(links_not_filtered),nodesToNodeAndFormat(),createPie(),createOverlayText(),updateData({minNumConnections:20,simulation,svg,g,gl:gl_}),initializeCarousel(t=>{"All"!=(currentTopic=t)?(mapMin=minMaxMap[currentTopic].min,mapMax=minMaxMap[currentTopic].max):[mapMin,mapMax]=[1,60],updateDialText(currentDialDeg,e)},topicCarouselList,350,600,30,10,svg,FAB_PALETTE);let t=t=>{currentLabHighlightList=t,updateData({minNumConnections,simulation,svg,g,gl:gl_})},e=(t,e=!1)=>{minNumConnections=t,updateData({minNumConnections:t,simulation,svg,g,gl:gl_,isFirst:e})};initializeDial(svg,e),initializeLabMultiselect(labs,t)})};